% !TEX root = ../vr_st.tex

\section{Barcode estimates}\label{s:computations}

In this section, we provide estimates of the barcode of $\R$-spaces in terms of their \textit{first critical values}.
The main examples we analyze in detail are the Vietoris--Rips complexes of wedges and quotients of spheres.

\subsection{First critical values and general estimates}\label{sub:general_barcodes}

\subsubsection{}\label{subsub:first_critical_value}

Let $X$ be an $\R$-space which is empty for negative numbers, with the Vietoris--Rips complex of a metric space as a primary example.
From now on, we will consider this $\R$-space and omit it from the notation when convenient.
Its \defn{first critical value} is the supremum among real numbers $r$ such that $X_{s,t}$ is a homotopy equivalence for any $s,t \in [0,r]$.

The first critical value of a persistent module which is \(0\) for negative numbers is defined analogously.
Clearly, the first critical value of an $\R$-space is bounded above by the first critical value of its $\degp^\th$ homology, as well as that of \(\img\theta\) and \(\ker\theta\) for any linear cohomology operation $\theta$.

\subsubsection{}\label{subsub:barcode_general}

%Let $X$ be an $\R$-space which is empty for negative numbers.
Let \(\degp \in \N\) and \(\theta \in \cO(\ell,\degp)\) a linear cohomology operation with \(\ell \neq \degp\).
We respectively denote by $\alpha, \beta_\degp$ and $\gamma_\degp$ the first critical values of $X$, \(\rH_\degp\), and \(\img_\theta\).

Because the $\R$-space $X$ begins at $r=0$ and the homotopy type of $X_r$ remains unchanged for $r\in [0,\alpha)$, bars in both the homology barcodes and the $\theta$-barcodes either start at $0$ or start after $\alpha$.

In addition, for degrees $\degp$ such that $\rH_\degp(X_0)$ is non-trivial, the barcode of the $\degp^\th$ reduced homology of $X$ always contains $(0,\beta_\degp )$.
For linear cohomology operations $\theta \in \cO(\ell, \degp)$ such that $\img \theta_{X_0}$ is non-trivial, the $\theta$-barcode of $X$ always contains $(0,\gamma_\degp)$.
\anibal{The fact that the maps are not isomorphisms after their critical value does not imply that they are not injective. You can say that they contain a bar dominated by \((0,\gamma_\degp)\)}.
We illustrate our estimate of the barcodes of $X$ in \cref{fig:barcodes_general}\anibal{Why are there 3 dots on the left?}.

\begin{figure}
	\centering
	\input{sec/fig_barcodes_general}
	\caption{Let $X$ be an $\R$-space where $X_r$ is empty for $r<0$ and contractible for $r\geq R$ for some real number $R$. \emph{Top row:} the $\degp^\th$ persistent homology barcode of $X$; the leftmost one contains one $(0,\beta_m)$ and some bars of the form $(0,a)$ for some $a\in [\beta_\degp, R]$.
		\emph{Bottom row:} $\theta$-barcodes of $X$, where $\theta\in\cO(\ell,\degp)$ is a linear cohomology operation; the leftmost one contains one $(0,\gamma_m)$ and some bars of the form $(0,b)$ for some $b\in [\beta_\degp, R]$.}
	\label{fig:barcodes_general}
\end{figure}

\subsection{Spheres}\label{ss:Sn}

For any integer $n \geq 1$ and real number $r > 0$, let $\bS^n(r)$ be the \defn{$n$-sphere} of radius $r$ centered at the origin of $\R^{n+1}$.
We consider it equipped with the geodesic distance.
We simplify notation writing \(\bS^n\) instead of \(\bS^n(1)\).

Because the Vietoris--Rips complexes of $\bS^n$ is contractible when the scale parameter is greater than $\pi$, all its bars are dominated by $(0, \pi)$.

Recall from \cite[Thm.~7.1]{lim2020vietoris} that for $n \in \N$ and
\[
0 < r \leq \zeta_n \defeq \arccos(\tfrac{-1}{n+1}),
\]
the space $\VR_r\bS^n$ is homotopy equivalent to $\bS^n$.
This implies that, for any degree~$\degp$, all bars in $\barc\rH_\degp (\VR\bS^n)$ are dominated by $(\zeta_n,\pi)$ with the exception of a single bar $(0,\zeta_n)$ when $d = n$ (see Figure \ref{fig:Sk}).\footnote{
	The case $n = 1$ has more information.
	From \cite[Thm.~7.4]{adamaszek2017vietoris} it is known that $\VR_r\bS^1$ is homotopy equivalent to $\bS^{2n+1}$ for any $n \in \N$ and $\frac{2n\pi}{2n+1} < r \leq \frac{2(n+1)\pi}{2n+3}$.
	For $d=1$ and $n > 1$ and one also has more information.
	Recall that a metric space $(\cX, d)$ is said to be a \defn{geodesic space} if for each $x, y \in \cX$ there exists geodesic from $x$ to $y$ of length $d(x, y)$.
	As stated in \cite[Prop.~7.10]{virk20201} one knows that if $\cX$ be a simply-connected geodesic space, then $\barc\rH_1(\cX) = \emptyset$.
	Since the spheres we are considering are geodesic their $\rH_1$ barcode is empty.}

\begin{figure}[ht]
	\centering
	\input{sec/table_sphere}
	\caption{Estimation of the persistent homology barcode of $\bS^n$.
	In each figure, the gray area represents the only region, apart from the blue dot, where points could potentially exist within the corresponding barcode.
	Here, and throughout the paper, $\zeta_n = \arccos(\tfrac{-1}{n+1})$ and $\rH_\degp $ denotes reduced $\degp$-homology.
	We remark that for any \(n \in \N\) the value \(\zeta_n\) is bounded below by \(\pi/2\).}
	\label{fig:Sk}
\end{figure}

Similarly, for any linear cohomology operation $\theta \in \cO(\ell,m)$ with $\ell \neq m$, every bar in the barcode of $\img\theta_{\VR\bS^n}$ or $\ker\theta_{\VR\bS^n}$ is dominated by $(\zeta_n,\pi)$.

\anibal{The analysis here is a special case of the one on the first subsection. Please rewrite to reflect this fact.}

\subsection{Wedge sum of spheres}

\subsubsection{}

For $n \in \N$ and $\ell_1, \dots, \ell_n \in \N^n$, let
\[
\VS^{\ell_1,\dots,\ell_n} =
\overbrace{\bS^1\vee\dots\vee\bS^1}^{\ell_1} \vee\dots\vee \overbrace{\bS^n\vee\dots\vee\bS^n}^{\ell_n}.
%(\bS^1)^{\vee m_1} \vee \dots \vee (\bS^n)^{\vee m_n}.
\]
Using the homotopy equivalence between the Vietoris--Rips filtration of a metric gluing with the wedge sum of the Vietoris--Rips filtration described in \cref{ss:wedge sum}, we have the following isomorphisms of persistence modules:
\[
\rH_\degp (\VR\VS^{\ell_1,\dots,\ell_n}) \cong \, \bigoplus_{i=1}^n \rH_\degp (\VR\bS^i)^{\oplus \ell_i}
\]
for any \(m \in \N\) and
\[
\img\theta_{\VR(\VS^{\ell_1,\dots,\ell_n})} \cong \, \bigoplus_{i=1}^n (\img\theta_{\VR\bS^i})^{\oplus \ell_i}
\]
for any linear cohomology operation.
Therefore, the barcode of $\rH_\degp(\VS^{\ell_1,\dots,\ell_n})$ contains $\ell_\degp$ copies of $(0,\zeta_\degp)$.
All remaining bars in this barcode must be dominated by $(\zeta_n, \pi)$.
This holds for all degrees, with the convention that $\ell_\degp = 0$ for $\degp > n$.

Similarly, for any linear cohomology operation $\theta \in \cO(\ell,m)$ with $\ell \neq m$, every bar in either its $\img\theta$ or $\ker\theta$ barcode is dominated by $(\zeta_n, \pi)$.

\begin{figure}
	\centering
	\input{sec/fig_barcodes_spheres}
	\caption{Let $\VS = \VS^{\ell_1,\dots,\ell_n}$ for some tuple of non-negative integers.
	\emph{Top row:} persistent homology barcodes of $\VS$, where the dot $(0,\zeta_m)$ has multiplicity $\ell_m$.
	\emph{Bottom row:} $\theta$-barcodes of $\VS$ where $\theta \in \cO(\ell,m)$ is any linear cohomology operation with \(\ell \neq m\).}
	\label{fig:barcodes_vs}
\end{figure}

\anibal{The analysis here is a special case of the one on the first subsection. Please rewrite to reflect this fact.}

\subsection{Quotients of spheres}

\subsubsection{}

%An action of a group $G$ on a set $X$ is a function $G\times X\to X$ such that $g\cdot (h\cdot x)=(gh)\cdot x$, and $e\cdot x = x$ for all $x\in X$ and $g,h\in G$, where $e$ is the identity element of $G$.

Let $G$ be a group acting on a metric space $\cX$ and $\cX_G$ be the quotient of $X$ under the group action $G$. 
Elements in $\cX_G$ will be denoted as $[x]$ for $x\in \cX$.
We say the action of $G$ is \defn{proper} if, for every $x\in \cX$, there is some $r>0$ such that $\{g \mid g\cdot B(x,r)\cap B(x,r)=\emptyset\}$ is finite. 
We say $G$ \defn{acts by isometries} on $\cX$, if for very $g\in G$, the map $g:X\to X$ with $x\mapsto g\cdot x$ is an isometry.

Let $G$ be a group acting properly and by isometries on a metric space $\cX$.
Then there is a well-defined metric on $\cX_G$, called \defn{quotient metric}, defined by 
\[
    d_{\cX_G}([x], [x']) \defeq \inf_{g\in G} d_\cX(x, g\cdot x').
\]

The action of $G$ on $\cX$ induces a group action of $G$ on the Vietoris-Rips complexes $\VR_r(\cX)$, defined by
\[
    g \cdot \sum \lambda_i x_i \defeq \sum \lambda_i (g\cdot x_i).
\]

Let $r>0$. The action of a group $G$ on $\cX$ is an \defn{$r^*$-diameter action} if for any non-negative integer $k$, $\diam_{\cX_G}\{[x_0],\dots,[x_k]\}<r$ implies that there exist unique choice of $g_i$'s for $1\leq i\leq k$ such that $\diam_{\cX}\{x_0,g_1x_1,\dots,g_kx_k\}<r$. 
\ling{We need to be careful with the citation here: (1) cite \cite{adams2022metric} for the original definition; (2) cite Liam Barham for the fixed definition. 
We should ask Liam Barham for permission to cite his unpublished work.}

\subsubsection{}\label{subsub:h}

We begin by examining the relationship between the Vietoris--Rips filtration of a quotient space and the Vietoris--Rips filtration induced by the quotient.
The following proposition is proved in \cite[Proposition 3.5]{adams2022metric}, we include a proof sketch below for clarity.

\medskip\lemma
Let $G$ acts properly and by isometry on $\cX$, and the action of $G$ on $\cX$ is a $r^*$-diameter action for $r>0$. Then, the map
\[
h \colon \VR_r\cX_G \to (\VR_r\cX)_G
\text{ with }
\sum_{i=1}^k \lambda_i [x_i] \mapsto [\sum_{i=1}^k \lambda_i x_i]
\]
is an isomorphism of simplicial complexes.

\begin{proof}
	Because $G$ acts by isometry, we have a well-defined map
	\[
	\tilde{h} \colon \VR_r\cX \to \VR_r\cX_G
	\text{ with }
	\sum_{i=1}^k \lambda_i x_i \mapsto \sum_{i=1}^k \lambda_i [x_i],
	\]
	Because two points in the same orbit of the $G$ action always have the same image under $\tilde{h}$, it induces a map $\tilde{h}_G \colon (\VR_r\cX)_G \to \VR_r\cX_G$.

	Moreover, $\tilde{h}_G$ is an isomorphism, following from the fact that the action of $G$ on $\cX$ is an $r^*$-diameter action; see \cite[Proposition 3.5]{adams2022metric} for further details.
	Therefore, $h$, the inverse of $\tilde{h}_G$, is also an isomorphism.
\end{proof}

\subsubsection{}
\label{subsub:f}

For any $r<\pi$, let $f$ be the composition
\[
f \colon \VR_r\bS^n \to \R^{n+1} \setminus \set{0} \xra{\pi} \bS^n,
\]
where the first map sends a formal linear sum $\sum_{i=1}^k \lambda_i x_i$ in the Vietoris--Rips thickening $\VR_r\bS^n$ to the point $\sum_{i=1}^k \lambda_i x_i \in \bbR^{n+1}$ where $x_i \in \bS^n$ and $\lambda_i \in [0,1]$ satisfying $\sum_i\lambda_i=1$, and the second map $\pi$ is the radial projection map.

\medskip\lemma
When $0<r<\zeta_n=\arccos{(-\tfrac{1}{n+1})}$, the map $f$ is a weak homotopy equivalence.
\footnote{For $0<r<\zeta_n$, the Vietoris-Rips complex $\VR_r\bS^n$ is indeed homotopic to $\bS^n$, as shown in \cite[Theorem 7.1]{lim2020vietoris}.}

\begin{proof}
	To prove the statement, we use an intermediate construction called the Vietoris--Rips thickening, introduced in \cite{adamaszek2018metric} as a metric space analogue of the Vietoris--Rips complexes.

	The Vietoris--Rips thickening $\VR_r^m\cX$ of a metric space $\cX$ at a given scale $r$ is defined as the set of convex linear combinations of the Dirac probability measures $\delta_{x}$ on points $x \in X$, equipped with the $1$-Wasserstein metric.
	There is a set bijection from $g \colon \VR_r\cX \to \VR_r^m\cX$, given by $\sum_{i=1}^k\lambda_i x_i\mapsto \sum_{i=1}^k\lambda_i\delta_{x_i}.$
	%As this object is not the center of the discussion here, we omit the details and only state the related results here.
	It is shown in \cite[Theorem 1]{gillespie2024vietoris} that (for open Vietoris-Rips complexes) the natural bijection $g$ is a weak homotopy equivalence.

	In the case of $\cX = \bS^n$, the map $f$ is the composition of two maps
	\[\VR_r\bS^n\xrightarrow{g}\VR_r^m\bS^n\xrightarrow{f \circ g^{-1}}\bS^n.\]
	According to \cite[Proposition 5.3]{adamaszek2018metric}, when $0<r<\zeta_n$, $f \circ g^{-1}$ is a homotopy equivalence, implying that $f = (f \circ g^{-1}) \circ g$ is a weak homotopy equivalence.
\end{proof}

\subsubsection{}
\label{subsub:rho}
Let $f$ be the map defined in \cref{subsub:f}.
Let $G$ be a group action on $\bS^n$ that commutes with $f$.
Let $f_G \colon \VR_r\bS^n_G \to \bS^n_G$ be the induced map of $f$.

\medskip\lemma
For any $0<r<\zeta_n$, the following composition is a weak homotopy equivalence
\[
\rho \defeq h \circ f_G
\colon \VR_r\bS^n_G \to \bS^n_G.
\]
\begin{proof}
	By \cref{subsub:f}, the map $f$ is a weak homotopy equivalence when $0<r<\zeta_n$.
	Then, because $G$ is a group action on $\bS^n$ preserved by $f$, the induced map $f_G$ is also a weak homotopy equivalence.
	Furthermore, as the map $h$ (defined in \cref{subsub:h}) is a homomorphism, its composition with $f_G$ is a weak homotopy equivalence.
\end{proof}

\subsubsection{}

Let $\rho^n$ (or $\rho^{n-1}$) be the weak homotopy equivalence defined in \cref{subsub:rho} for the case of $\bS^n$ (or $\bS^{n-1}$).

\medskip\lemma
For $0<t\leq s $, we have the following diagram of topological spaces:
\begin{equation}\label{d:fundamental_bars_diagram}
	\begin{tikzcd}
		\bS^{n-1}_G
		\ar[d, hook,"{\iota}" left]
		&
		\VR_t\bS^{n-1}_G
		\ar[d, hook,"\iota_t"]
		\ar[l, "\rho^{n-1}" above]
		\ar[r, hook, "v^{n-1}"]
		&
		\VR_{s}\bS^{n-1}_G
		\ar[d, hook]
		\\
		\bS^{n}_G
		&
		\VR_t(\bS^{n}_G)
		\ar[l, "\rho^n" below]
		\ar[r, hook, "v^{n}"]
		&
		\VR_{s}\bS^{n}_G.
	\end{tikzcd}
\end{equation}
The horizontal inclusions $v^{n-1}$ and $v^n$ are induced by the Vietoris--Rips filtration.
The vertical maps are induced by the equatorial inclusion of real projective spaces $\iota \colon \bS^{n-1}_G \hookrightarrow \bS^{n}_G$.

\begin{proof}
	The commutativity of the right-hand-side square is straightforward.
	For the left-hand-side square, take any $y = \sum_{i=1}^k \lambda_i [x_i] \in \VR_t\bS^{n-1}_G$ and verify that
	\begin{center}
		$(\iota \circ \rho^{n-1})(y)
		=\iota(f^{n-1}_G([\sum_i \lambda_i x_i]))
		=\iota([f^{n-1}(\sum_i \lambda_i x_i)])
		=[\pi^{n-1}(\sum_i \lambda_i x_i)]
		$
	\end{center}
	as an element in $\bS^n_G$, and
	\begin{center}
		$(\rho^{n} \circ \iota_t)(y) = \rho^{n}(y) = f^{n}_G([\sum_i \lambda_i x_i]) = [f^{n}(\sum_{i=1}^k \lambda_i x_i)] = [\pi^{n}(\sum_i \lambda_i x_i)].
		$
	\end{center}
	Because $\pi^{n}$ restricted to $\bS^{n-1}_G$ is equal to $\pi^{n-1}$, we conclude that $(\iota \circ \rho^{n-1})(y) = (\rho^n \circ \iota_t)(y)$ for any $y$.
	Thus, the diagram commutes.
\end{proof}

\subsubsection{}
\label{subsub:foundamental_bar_rpn_lemma}

Let $\delta_n=2\mathrm{Fillrad}(\bS^n_G)$, which is clearly upper bounded by $\alpha_n$ the first critical value of $\VR\bS^n_G$.
For any degree $1 \leq \degp \leq n$, let $\beta_{\degp, n}$ be the first critical value of the $\degp^\th$ reduced homology of $\VR\bS^n_G$.

\medskip\lemma
If $\delta_1 = \dots = \delta_n$ and $\beta_{\degp, n} \leq \beta_{\degp, n'}$ for any $n\leq n'$, then
\[
\beta_{m, n} = \delta_1, \, \text{for any $1 \leq m \leq n$.}
\]

\ling{can the above be relaxed?}

\begin{proof}
	We will use an induction argument on $n$.
	When $n = 1$, it follows from \cref{ss:filling_radius} that
	\[
	(0, 2\mathrm{Fillrad}(\bS^1_G)) = (0, \delta_1) \in \Hbarc[\field]{1}{\bS^1_G}.
	\]
	This implies that $\rH_1(\VR\bS^1_G)$ changes isomorphism types at $\delta_1$, so $\beta_{1, 1} \leq \delta_1$.
	On the other hand, because $\delta_1 \leq \alpha_1$, $\rH_1(\VR\bS^1_G)$ retains the same isomorphism type before $\delta_1$, implying that $\beta_{1, 1} \geq \delta_1$.
	Thus, $\beta_{1, 1} =\delta_1$.

	Assume the statement holds for $\bS^{n-1}_G$, that is, $\beta_{m, n-1} = \delta_1$ for any $1\leq m \leq n-1$.
	Applying the $\degp^\th$ reduced homology functor to diagram \eqref{d:fundamental_bars_diagram}, we obtain the following commutative diagram of vector spaces:
	for $r,\epsilon>0$ small,
	\[
	\begin{tikzcd}
		\rH_\degp(\bS^{n-1}_G)
		\ar[d, "\cong" left]
		&
		\rH_\degp(\VR_r\bS^{n-1}_G)
		\ar[d, "\rH_\degp(\iota_r)" left, "\cong" right, myred]
		\ar[l, "\cong" above]
		\ar[rr, "\rH_\degp(v^{n-1})=0", myred]
		&
		&
		\rH_\degp(\VR_{\delta_1+\epsilon}\bS^{n-1}_G)
		\ar[d]
		\\
		\rH_\degp(\bS^{n}_G)
		&
		\rH_\degp(\VR_r(\bS^{n}_G))
		\ar[l, "\cong"]
		\ar[rr, "\rH_\degp(v^n)" , myred]
		&
		&
		\rH_\degp(\VR_{\delta_1+\epsilon}\bS^{n}_G).
	\end{tikzcd}
	\]
	Here, $\rH_\degp(f)$ for some map $f$ between topological spaces denotes the induced map of $f$ on the $\degp^\th$ reduced homology.

	Commutativity of the left-hand-side square implies that $\rH_\degp(\iota_r)$ is an isomorphism.
	By induction assumption, $\beta_{m, n-1} = \delta_1$ is the first critical value of $\rH_\degp(\VR\bS^{n-1}_G)$, which implies that $\rH_\degp(v^{n-1})$ is the zero map.
	Then, using the right-hand-side square's commutativity, we deduce $\rH_\degp(v^n) \circ \rH_\degp(\iota_r)=0$.
	Since $\rH_\degp(\iota_r)$ is an isomorphism, we conclude that $\rH_\degp(v^n)=0$.
	This holds for any $\epsilon>0$, so we can conclude $\beta_{m, n} \leq \delta_1$.
	On the other hand, we have $\delta_1 = \beta_{m, n-1} \leq \beta_{m, n}$.
	Therefore, $\beta_{m, n} = \delta_1$ holds for any $1\leq m \leq n-1$.

	For the case when $\degp=n$, we can apply \cref{ss:filling_radius} to obtain
	\[
	(0,2\mathrm{Fillrad}(\bS^n_G)) = (0, \delta_n) = (0, \delta_1) \in \Hbarc{n}{\bS^n_G}.
	\]

	Therefore, $(0, \delta_1) \in \Hbarc[\field]{\degp}{\bS^n_G}$ is established for all $1\leq \degp\leq n.$
\end{proof}


